# 机器人建模与控制 · 动力学篇


> [!summary] 课程主线一眼看懂
> - **几何 → 运动学 → 动力学 → 轨迹规划 → 控制 → 行走案例**
> - 关键模型：
>   - 正/逆运动学、雅可比、操作能力  
>   - Lagrange & Newton–Euler 动力学  
>   - 关节/笛卡尔空间轨迹  
>   - PID + 前馈、计算力矩、力/阻抗控制与多足/双足行走  

---


## 0. 课程信息与整体结构

- 课程：**Robot Modeling & Control（ME331）**  
- 任课教师：**付成龙 Chenglong Fu**（SUSTech MEE）  
- 内容大致对应章节：  
  - 1–10：运动学（Kinematics I–IX）  
  - 11–15：动力学（Dynamics I–V）  
  - 16：轨迹规划 & 控制导论  
  - 17–19：执行器与控制（Control I–III）  

> [!tip] 学习顺序小建议  
> 1. 先把 **D-H 建模 + 正/逆运动学** 搞熟  
> 2. 再理解 **D(q)、C(q, q̇)、g(q)** 的来龙去脉  
> 3. 最后看 **控制律如何“利用”这些模型**（前馈补偿、计算力矩等）

---



## 5. Lagrange 动力学基础（Dyn I–II）

### 5.1 约束、虚功与 D’Alembert 原理

- 完整约束（Holonomic）：  
  $$
  g_i(r_1,\dots,r_k)=0
  \Rightarrow r_i = r_i(q_1,\dots,q_n)
  $$
- 虚位移：在同一时刻、满足约束的小位移 δrᵢ  
- 虚功原理（静力）：  
  $$
  \sum_i f_i^T \delta r_i = 0
  $$
- D’Alembert 原理（动力）：  
  $$
  \sum_i f_i^T \delta r_i - \sum_i \dot{p}_i^T \delta r_i = 0
  $$

### 5.2 Lagrange 方程

- 动能 K、势能 P、广义力 τⱼ  
- **Lagrangian**：  
  $$
  \mathcal{L}(q,\dot{q}) = K(q,\dot{q}) - P(q)
  $$
- Euler–Lagrange 方程：  
  $$
  \frac{d}{dt}\frac{\partial \mathcal{L}}{\partial \dot{q}_j}
  -
  \frac{\partial \mathcal{L}}{\partial q_j}
  = \tau_j
  $$

---

## 6. n 连杆机器人的动能、势能与动力学方程（Dyn II–III）

### 6.1 单刚体动能

- 刚体动能：
  $$
  K = \frac12 m v^T v + \frac12 \omega^T \mathcal{I}\,\omega
  $$
- 惯性张量在不同坐标系间的变换：
  $$
  \mathcal{I} = R I R^T
  $$

### 6.2 n 连杆机器人动能

- 对第 i 链节：
  $$
  v_i = J_{v,i}(q)\dot{q},\quad
  \omega_i = J_{\omega,i}(q)\dot{q}
  $$
- 总动能：
  $$
  K = \frac12 \dot{q}^T D(q) \dot{q}
  $$
  其中 D(q) 为 **惯性矩阵**，对称、正定。

### 6.3 势能与动力学标准形式

- 势能 P(q) 通常由各质心重力势能叠加得到  
- Lagrange 方程可化为标准形式：
  $$
  D(q)\,\ddot{q} + C(q,\dot{q})\,\dot{q} + g(q) = \tau
  $$
- 其中：
  - D(q)：惯性矩阵  
  - C(q, q̇)：Coriolis / 离心项  
  - g(q)：重力项  
  - τ：广义驱动力矩

---

## 7. 动力学方程性质 & 广义力（Dyn III–IV–V）

### 7.1 动力学方程性质

- D(q) 对称 & 正定  
- $\dot{D}(q) - 2C(q,\dot{q})$ 为斜对称矩阵  
- 动力学对物理参数 **线性**：
  $$
  \tau = Y(q,\dot{q},\ddot{q})\,\pi
  $$
  其中 π 为惯性、质量等物理参数向量，Y 为回归矩阵

> [!tip] “线性于参数”的意义  
> - 便于做机器人 **参数辨识** 和 **自适应控制**（在线估计 π）

### 7.2 广义力：阻尼、摩擦、接触

在标准形式基础上，广义力可进一步拆分：

- 纯驱动：
  $$
  D\ddot{q} + C\dot{q} + g = B\tau
  $$
- 加粘性阻尼：
  $$
  D\ddot{q} + C\dot{q} + g = B\tau - F_v \dot{q}
  $$
- 再加库仑摩擦：
  $$
  D\ddot{q} + C\dot{q} + g = B\tau - F_v\dot{q} - F_s\,\text{sgn}(\dot{q})
  $$
- 若末端与环境接触、受力 F：
  $$
  D\ddot{q} + C\dot{q} + g = B\tau - F_v\dot{q} - F_s\,\text{sgn}(\dot{q}) + J^T(q)F
  $$

---

## 8. 冲击动力学 & 双足行走示例（Dyn IV–V）

### 8.1 冲击假设与混合系统

- 假设：冲击瞬间  
  - 位形 q 连续  
  - 速度 q̇ 发生突变  
  - 冲击力视作脉冲，积分得到速度跃变关系  
- 冲击前后状态满足约束矩阵与冲击冲量的线性关系  
- 系统本质为 **混合系统（Hybrid System）**：  
  - 连续部分：$\dot{x} = f(x)$  
  - 离散部分：$x^+ = \Delta(x^-)$

### 8.2 双足行走示例

- 5 自由度平面模型：躯干 + 两腿，忽略脚长  
- 步态由：
  - 单支撑相（摇摆腿摆动）  
  - 瞬时双支撑相（脚碰撞 + 膝盖碰撞）  
  交替构成周期行走  
- 关键在于：  
  - 用动力学模型设计稳定极限环（周期步态）  
  - 通过反馈控制保证步态稳定

---

## 9. 用 MATLAB 符号工具推导 D、C、g（Dyn V）

### 9.1 基本步骤

1. 定义广义坐标 q、q̇  
2. 写出每个质心位置 pᵢ(q)  
3. 用 `jacobian(p_i, q)*dq` 求各质心速度 vᵢ  
4. 叠加得到总动能 K、势能 P  
5. 用  
   - `D = jacobian(jacobian(KE, dq).', dq);` 得到 D(q)  
   - `G = jacobian(PE, q).';` 得到 g(q)  
6. 用 Christoffel 符号公式循环构造 C(q,q̇)

> [!tip] 实战用途  
> - 推出符号形式后，可自动生成 ODE 函数，直接喂给 `ode45` 或 Simulink 做仿真。

---

## 10. Newton–Euler 动力学（Dyn V）

### 10.1 Lagrange vs Newton–Euler

- **Lagrange**：能量法，看整体  
  - 优点：形式紧凑、方便做控制理论和性质分析  
- **Newton–Euler**：逐连杆写牛顿/欧拉方程，前向–后向递推  
  - 优点：数值效率高，适合实时逆动力学计算

### 10.2 Newton–Euler 两个方程（连杆 i）

- Newton（线加速度）：
  $$
  f_i - R_i^{i+1} f_{i+1} + m_i g_i = m_i a_{c,i}
  $$
- Euler（角加速度）：
  $$
  \tau_i - R_i^{i+1}\tau_{i+1} + f_i\times r_{i-1,c_i} - R_i^{i+1}f_{i+1}\times r_{i,c_i}
  = I_i \dot{\omega}_i + \omega_i \times (I_i \omega_i)
  $$

> [!idea] 递推思路  
> 1. 从基座向末端前向递推：求每段的速度、加速度  
> 2. 从末端向基座后向递推：求各关节所需力矩
