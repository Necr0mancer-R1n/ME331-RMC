# 机器人建模与控制 · 控制与轨迹规划篇


> [!summary] 课程主线一眼看懂
> - **几何 → 运动学 → 动力学 → 轨迹规划 → 控制 → 行走案例**
> - 关键模型：
>   - 正/逆运动学、雅可比、操作能力  
>   - Lagrange & Newton–Euler 动力学  
>   - 关节/笛卡尔空间轨迹  
>   - PID + 前馈、计算力矩、力/阻抗控制与多足/双足行走  

---


## 0. 课程信息与整体结构

- 课程：**Robot Modeling & Control（ME331）**  
- 任课教师：**付成龙 Chenglong Fu**（SUSTech MEE）  
- 内容大致对应章节：  
  - 1–10：运动学（Kinematics I–IX）  
  - 11–15：动力学（Dynamics I–V）  
  - 16：轨迹规划 & 控制导论  
  - 17–19：执行器与控制（Control I–III）  

> [!tip] 学习顺序小建议  
> 1. 先把 **D-H 建模 + 正/逆运动学** 搞熟  
> 2. 再理解 **D(q)、C(q, q̇)、g(q)** 的来龙去脉  
> 3. 最后看 **控制律如何“利用”这些模型**（前馈补偿、计算力矩等）

---



## 11. 轨迹规划：关节空间 & 笛卡尔空间（Sec.16）

![典型关节空间/笛卡尔空间轨迹形状示意](fig-traj-cubic.png)


### 11.1 Path vs Trajectory

- **Path**：一串按顺序排列的配置（点集），不含时间信息  
- **Trajectory**：在 path 上加上时间标记 → 得到 q(t), q̇(t), q̈(t)

### 11.2 关节空间规划

> [!note] 描述的是 **每个关节** 怎么随时间转 / 移

- 优点：  
  - 关节限制易处理  
  - 数值稳定，不直接遭遇奇异  
- 缺点：  
  - 末端路径不直观，是否走直线难以控制

#### 11.2.1 端点已知速度的三次多项式

给定：
$$
\theta(0)=\theta_0,\ \dot{\theta}(0)=\dot{\theta}_0,\ 
\theta(T)=\theta_f,\ \dot{\theta}(T)=\dot{\theta}_f
$$

采用：
$$
\theta(t) = a_0 + a_1 t + a_2 t^2 + a_3 t^3
$$

- 四个边界条件 → 四个系数 a₀…a₃  
- 写出线性方程组求解即可

#### 11.2.2 经过中间 via 点 & 加速度连续

- 多段三次曲线拼接，通过  
  - 位置连续：θ⁺ = θ⁻  
  - 速度连续：θ̇⁺ = θ̇⁻  
  - 若需要，加速度连续：θ̈⁺ = θ̈⁻  
  构造方程保证轨迹平滑

### 11.3 笛卡尔空间规划

> [!note] 直接在任务空间指定末端轨迹（例如直线运动）

- 优点：末端路径可控、可视化强（如直线、圆等）  
- 缺点：  
  - 需频繁求 IK，计算量大  
  - 可能遇到雅可比奇异、路径穿过自身等问题

---

## 12. 控制系统总框架（Control I）

### 12.1 任务层 → 轨迹层 → 关节控制层

- 典型结构：

```text
任务规划（给末端任务）
   ↓
轨迹规划器（关节/笛卡尔空间）
   ↓
控制器（PID / 计算力矩 / 力控）
   ↓
机器人动力学 D(q)ddq + C(q,dq)dq + g(q) = τ
   ↑
传感器反馈（编码器、力/力矩、IMU…）
```

- 关节空间控制：直接对 q 进行跟踪  
- 笛卡尔空间控制：  
  - 用正/逆运动学 + 雅可比，把误差从任务空间映射到关节空间  
  - 然后再算关节力矩

---

## 13. 执行器与驱动链建模（Control I）

### 13.1 直流电机模型：电气部分

- 电枢回路：
  $$
  L\frac{di_a}{dt} + R i_a = V - V_b
  $$
- 转矩：
  $$
  \tau_m = K_m i_a
  $$
- 反电动势：
  $$
  V_b = K_b \omega_m
  $$

### 13.2 机电耦合：电机–负载系统

- 电机+齿轮的转动方程：
  $$
  J_m \ddot{\theta}_m + B_m \dot{\theta}_m = \tau_m - \tau_l/r
  $$
- 与电气方程联立，得到从电压 V 到转角 θₘ 的传递函数：
  $$
  \frac{\Theta_m(s)}{V(s)} =
  \frac{K_m}{s[(Ls+R)(J_m s + B_m) + K_b K_m]}
  $$
- 忽略电感 L 后，可得到更简单的一阶电流近似模型

> [!tip] 工程惯用做法  
> - 将电机+齿轮+摩擦合并成“有效惯量 J_eff 和阻尼 B_eff”，简化为单输入单输出模型

---

## 14. 独立关节控制：PID + 前馈（Control I–II）

### 14.1 独立关节模型

- 在关节 k 上，将其它关节耦合作为“扰动” dₖ(t)：
  $$
  J_{\text{eff},k}\ddot{\theta}_k + B_{\text{eff},k}\dot{\theta}_k = u_k - d_k
  $$
- 每个关节视作单输入单输出（SISO）系统

### 14.2 PID 控制器

- 一般形式：
  $$
  u_k(t) = K_p e_k + K_i \int e_k dt + K_d \dot{e}_k
  $$
  其中 $e_k = \theta_{d,k} - \theta_k$。  
- 两自由度 PID：可对 **跟踪性能** 与 **扰动抑制** 分开调整（参考课件框图）

### 14.3 前馈补偿：利用动力学模型

- 仅靠 PID 难以在高速、大负载下取得好跟踪 → 引入 **前馈项**  
- 典型 joint-space 前馈：
  $$
  \tau_{\text{ff}} = D(q)\ddot{q}_d + C(q,\dot{q}_d)\dot{q}_d + g(q)
  $$
- 配合反馈：
  $$
  \tau = \tau_{\text{ff}} + K_p e + K_d \dot{e}
  $$
- 可显著减小跟踪误差，对模型误差靠反馈补偿

---

## 15. 多变量控制 & 计算力矩控制（Control II–III）

### 15.1 计算力矩控制（Computed Torque）

- 利用完整动力学模型对系统“反馈线性化”  
- 设：
  $$
  \tau = D(q)v + C(q,\dot{q})\dot{q} + g(q)
  $$
  代入动力学：
  $$
  D(q)\ddot{q} + C(q,\dot{q})\dot{q} + g(q) = D(q)v
  \Rightarrow \ddot{q} = v
  $$
- 再选：
  $$
  v = \ddot{q}_d + K_d(\dot{q}_d - \dot{q}) + K_p(q_d - q)
  $$
- 得到误差方程：
  $$
  \ddot{e} + K_d \dot{e} + K_p e = 0
  $$
  为 n 维解耦二阶系统（若 K_p, K_d 选得好则渐近稳定）

### 15.2 笛卡尔空间控制

- 在任务空间构造控制律，对末端位置/姿态误差进行 PD 或 PID  
- 再通过雅可比/逆雅可比映射到关节力矩  
- 常见形式：  
  - 任务空间 PD + 逆雅可比得到关节加速度/速度，再用动力学计算 τ  

---

## 16. 力控制：直接力控 & 阻抗控制（Control II–III）

### 16.1 直接力控制（Direct Force Control）

> [!note] “我就要末端施加 xx 牛的力”

- 外环：比较期望力 F_d 与测量力 F  
- 输出：期望末端位移/速度/加速度  
- 内环：关节位置/速度闭环  
- 对环境刚度、接触模型比较敏感，容易振荡

### 16.2 阻抗控制（Impedance Control）

> [!idea] 不是直接控制“力”，而是控制“力–位移关系”

- 目标：让机器人末端在某方向满足期望“质量–阻尼–弹簧”关系：
  $$
  M_d (\ddot{x} - \ddot{x}_d)
  + B_d (\dot{x} - \dot{x}_d)
  + K_d (x - x_d)
  = F_{\text{ext}}
  $$
- 优点：
  - 不用精确环境刚度  
  - 更鲁棒、更自然，适合人机协作、接触任务

### 16.3 混合力/位置控制（Hybrid Force/Motion）

- 将任务空间分解为：
  - 法向方向 → 控制力  
  - 切向方向 → 控制位置  
- 典型例子：沿着工件表面移动时，  
  - 法向保持恒定接触力  
  - 切向跟踪轨迹

---

## 17. 行走原理与足式机器人（Control III + Dyn IV–V）

- 行走由 **单支撑 + 双支撑瞬时冲击** 交替组成  
- 脚落地和膝盖碰撞是典型冲击事件  
- 系统状态在“连续动力学 + 离散冲击映射”之间切换，即 **Hybrid Dynamics**  
- 经典双足行走研究关注：
  - 利用动力学模型设计稳定极限环（周期步态）  
  - 用反馈控制保证步态对扰动的鲁棒性  

---

## 18. 整体复习 & 自查清单

> [!check] 运动学部分（1–10）
> - 能够：
>   - ✅ 根据结构图写出完整 D-H 表，并推导 $T^0_n(q)$  
>   - ✅ 对常见 2R / 3R / SCARA / 球腕 6R，讲清 IK 思路、解的个数与奇异姿态  
>   - ✅ 手推简单机械臂的雅可比 J(q)，找出 det(J)=0 的情况  
>   - ✅ 说出 manipulability、condition number 的物理含义  

> [!check] 动力学部分（11–15）
> - 能够：
>   - ✅ 写出并解释 $D(q)\ddot{q} + C(q,\dot{q})\dot{q} + g(q) = \tau$ 中每一项  
>   - ✅ 用 Lagrange 方法为 2R / 双摆系统推导简化版方程  
>   - ✅ 知道 D 的对称/正定、$\dot{D}-2C$ 斜对称，以及线性于参数的意义  
>   - ✅ 理解广义力中阻尼、摩擦、JᵀF 等项如何加入  

> [!check] 轨迹规划 & 控制部分（16–19）
> - 能够：
>   - ✅ 用三次多项式做关节空间点到点轨迹规划，写出边界条件方程  
>   - ✅ 解释 joint-space vs Cartesian-space 规划的优缺点  
>   - ✅ 画出独立关节控制框图，说明 PID 各项作用、前馈项如何写  
>   - ✅ 写出计算力矩控制律，并推导出误差二阶线性方程  
>   - ✅ 区分直接力控 vs 阻抗控制 vs 混合力/位置控制的思想差异  
